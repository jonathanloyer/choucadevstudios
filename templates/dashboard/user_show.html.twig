{% extends 'layout.html.twig' %}

{# ========================
   SEO : titre + meta + NOINDEX (admin)
   ======================== #}
{% block title %}
  Fiche {{ user.fullName ?: user.email }} — Administration ChoucaDev Studios
{% endblock %}

{% block meta_description %}
  Fiche détaillée d’un utilisateur dans l’administration ChoucaDev Studios :
  coordonnées, adresse, rôles associés et éventuel abonnement de maintenance actif.
{% endblock %}

{# Page d’administration : on ne veut pas qu’elle soit indexée #}
{% block robots %}noindex,nofollow{% endblock %}

{% block body %}
<section class="max-w-3xl mx-auto px-4 py-10" aria-labelledby="user-show-title">

  <a href="{{ path('admin_dashboard') }}"
     class="mb-4 inline-flex items-center text-xs text-slate-400 hover:text-cyan-300">
    ← Retour au tableau de bord
  </a>

  <div class="rounded-2xl border border-slate-800 bg-slate-900/70 px-6 sm:px-8 py-8 shadow-xl">
    <header class="mb-6">
      <p class="text-[11px] font-semibold uppercase tracking-wide text-cyan-400">
        Fiche {{ user.isSubcontractor() ? 'sous-traitant' : 'client' }}
      </p>
      <h1 id="user-show-title" class="mt-1 text-2xl font-semibold text-slate-50">
        {{ user.fullName ?: user.email }}
      </h1>
      <p class="mt-2 text-sm text-slate-400">
        Compte géré par l’administrateur de ChoucaDev Studios. Les informations ci-dessous
        ne comprennent jamais le mot de passe de l’utilisateur.
      </p>
    </header>

    <div class="grid gap-6 md:grid-cols-2">
      {# Identité & contact #}
      <section aria-labelledby="user-contact" class="space-y-3">
        <h2 id="user-contact" class="text-sm font-semibold text-slate-100">
          Coordonnées
        </h2>

        <dl class="space-y-2 text-sm">
          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Email</dt>
            <dd class="text-slate-100">{{ user.email }}</dd>
          </div>

          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Prénom</dt>
            <dd class="text-slate-100">{{ user.firstname ?: '—' }}</dd>
          </div>

          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Nom</dt>
            <dd class="text-slate-100">{{ user.lastname ?: '—' }}</dd>
          </div>

          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Téléphone</dt>
            <dd class="text-slate-100">{{ user.phone ?: '—' }}</dd>
          </div>
        </dl>
      </section>

      {# Adresse & rôles #}
      <section aria-labelledby="user-address" class="space-y-3">
        <h2 id="user-address" class="text-sm font-semibold text-slate-100">
          Adresse &amp; rôles
        </h2>

        <dl class="space-y-2 text-sm">
          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Adresse</dt>
            <dd class="text-slate-100">{{ user.address ?: '—' }}</dd>
          </div>

          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Code postal</dt>
            <dd class="text-slate-100">{{ user.postalCode ?: '—' }}</dd>
          </div>

          <div class="flex justify-between gap-3">
            <dt class="text-slate-400">Ville</dt>
            <dd class="text-slate-100">{{ user.city ?: '—' }}</dd>
          </div>

          <div>
            <dt class="text-slate-400 text-sm mb-1">Rôles</dt>
            <dd class="flex flex-wrap gap-1">
              {% for role in user.roles %}
                <span class="inline-flex items-center rounded-full bg-slate-800 px-2 py-0.5 text-[10px] font-medium text-slate-200">
                  {{ role }}
                </span>
              {% endfor %}
            </dd>
          </div>
        </dl>
      </section>
    </div>

    {# Maintenance active (si client) #}
    {% set contract = user.activeMaintenanceContract %}
    <section class="mt-8 border-t border-slate-800 pt-5 space-y-3">
      <h2 class="text-sm font-semibold text-slate-100">
        Abonnement de maintenance
      </h2>

      {% if contract %}
        <p class="text-sm text-slate-300">
          Formule
          <span class="font-semibold">
            {{ contract.plan ? contract.plan.name : 'Maintenance' }}
          </span>,
          à
          <span class="font-semibold">
            {{ (contract.pricePerMonth / 100)|number_format(2, ',', ' ') }} € HT / mois
          </span>,
          actif depuis le {{ contract.startedAt|date('d/m/Y') }}.
        </p>
      {% else %}
        <p class="text-sm text-slate-400">
          Aucun abonnement de maintenance actif pour ce compte.
        </p>
      {% endif %}
    </section>

    <div class="mt-8 flex flex-wrap gap-3">
      <a href="{{ path('admin_user_edit_role', { id: user.id }) }}"
         class="inline-flex items-center rounded-full border border-slate-700 px-4 py-2 text-xs font-semibold text-slate-200 hover:border-cyan-400 hover:text-cyan-300 transition">
        Modifier les rôles
      </a>

      <a href="{{ path('admin_dashboard') }}"
         class="inline-flex items-center rounded-full border border-slate-700 px-4 py-2 text-xs font-semibold text-slate-300 hover:border-slate-500 hover:text-slate-100 transition">
        Retour au tableau de bord
      </a>
    </div>
  </div>
</section>
{% endblock %}
