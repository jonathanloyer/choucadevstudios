{% extends 'layout.html.twig' %}

{% block title %}Gestion des utilisateurs — Administration ChoucaDev Studios{% endblock %}

{% block meta_description %}
Interface d’administration de ChoucaDev Studios permettant de consulter les utilisateurs,
leurs rôles (client, sous-traitant, admin) et de modifier leurs droits d’accès.
{% endblock %}

{# Page admin → interdite d’indexation #}
{% block robots %}noindex,nofollow{% endblock %}

{% block body %}
<section class="max-w-5xl mx-auto px-4 py-10" aria-labelledby="users-admin-title">

  <header class="mb-6">
    <h1 id="users-admin-title" class="text-2xl sm:text-3xl font-semibold mb-2">
      Gestion des utilisateurs
    </h1>
    <p class="text-sm text-slate-300">
      Consulte la liste des comptes enregistrés sur ChoucaDev Studios et mets à jour leurs rôles :
      client, sous-traitant ou administrateur.
    </p>
  </header>

  {% for message in app.flashes('success') %}
    <div class="mb-3 rounded bg-emerald-500/10 border border-emerald-500/40 px-3 py-2 text-sm text-emerald-200" role="status">
      {{ message }}
    </div>
  {% endfor %}

  <div class="overflow-x-auto rounded-2xl bg-slate-900/60 border border-slate-800 shadow-lg shadow-slate-950/40">
    <table class="min-w-full text-sm text-left" aria-describedby="users-table-help">
      <caption id="users-table-help" class="sr-only">
        Liste des utilisateurs avec leur nom, email, rôle et un lien pour modifier leurs droits.
      </caption>

      <thead class="border-b border-slate-800 text-slate-400 bg-slate-950/50">
        <tr>
          <th scope="col" class="px-4 py-2">Nom</th>
          <th scope="col" class="px-4 py-2">Email</th>
          <th scope="col" class="px-4 py-2">Rôle</th>
          <th scope="col" class="px-4 py-2 text-right">Actions</th>
        </tr>
      </thead>

      <tbody>
      {% if users is empty %}
        <tr>
          <td colspan="4" class="px-4 py-4 text-xs text-slate-400 text-center">
            Aucun utilisateur enregistré pour le moment.
          </td>
        </tr>
      {% else %}
        {% for user in users %}
          <tr class="border-b border-slate-800/60 last:border-b-0 hover:bg-slate-900/40 transition">
            
            {# Nom #}
            <td class="px-4 py-2 text-slate-100">
              {{ user.fullName ?: '—' }}
            </td>

            {# Email #}
            <td class="px-4 py-2 text-slate-300">
              {{ user.email }}
            </td>

            {# Badge rôle #}
            <td class="px-4 py-2">
              {% if user.isAdmin() %}
                <span class="inline-flex items-center rounded-full bg-amber-500/20 px-2 py-0.5 text-[11px] font-medium text-amber-300">
                  Admin
                </span>
              {% elseif user.isSubcontractor() %}
                <span class="inline-flex items-center rounded-full bg-purple-500/20 px-2 py-0.5 text-[11px] font-medium text-purple-300">
                  Sous-traitant
                </span>
              {% elseif user.isClient() %}
                <span class="inline-flex items-center rounded-full bg-emerald-500/20 px-2 py-0.5 text-[11px] font-medium text-emerald-300">
                  Client
                </span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-500/20 px-2 py-0.5 text-[11px] font-medium text-slate-200">
                  Utilisateur
                </span>
              {% endif %}
            </td>

            {# Actions #}
            <td class="px-4 py-2 text-right">
              <a href="{{ path('admin_user_edit_role', { id: user.id }) }}"
                 class="inline-flex items-center rounded-full border border-slate-700 px-3 py-1 text-[11px] font-semibold text-slate-200 hover:border-cyan-400 hover:text-cyan-300 transition"
                 aria-label="Modifier le rôle de {{ user.fullName ?: user.email }}">
                Modifier le rôle
              </a>
            </td>
          </tr>
        {% endfor %}
      {% endif %}
      </tbody>
    </table>
  </div>

</section>
{% endblock %}
